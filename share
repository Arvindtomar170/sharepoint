#!/usr/bin/env python
import argparse
import json
import time
from pathlib import Path

import draccus

from lerobot.utils.utils import log_say, busy_wait
from lerobot.robots.so100_follower.config_so100_follower import SO100FollowerConfig
from lerobot.robots.so100_follower.so100_follower import SO100Follower

def load_robot_config(path: Path) -> SO100FollowerConfig:
    # draccus.parse will read the JSON/YAML and instantiate the correct config dataclass
    cfg = draccus.parse(SO100FollowerConfig, config_path=str(path), args=[])
    return cfg

def load_location(path: Path) -> dict:
    # location file format examples below. We support both "motor": value or "motor.pos": value
    with open(path, "r") as f:
        loc = json.load(f)
    return loc

def ensure_pos_keys(loc: dict) -> dict:
    # Send_action expects keys with ".pos" suffix. Normalize whatever the user supplies.
    out = {}
    for k, v in loc.items():
        if k.endswith(".pos"):
            out[k] = float(v)
        else:
            out[f"{k}.pos"] = float(v)
    return out

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--config", type=Path, required=True, help="Path to robot config JSON (SO100FollowerConfig).")
    parser.add_argument("--location", type=Path, required=True, help="Path to JSON file with target joint values.")
    parser.add_argument("--wait", type=float, default=2.0, help="Seconds to wait after sending a command.")
    args = parser.parse_args()

    cfg = load_robot_config(args.config)
    robot = SO100Follower(cfg)

    log_say(f"Connecting to robot with id={cfg.id} on port={cfg.port}...")
    robot.connect()  # blocks until connected

    log_say(f"Loading target location from {args.location} ...")
    loc = load_location(args.location)
    action = ensure_pos_keys(loc)

    log_say(f"Sending target pose to robot: {action}")
    sent = robot.send_action(action)
    log_say(f"Action sent: {sent}")

    # wait a bit or poll sensors if you need to wait until reached
    busy_wait(args.wait)

    robot.disconnect()
    log_say("Done.")

if __name__ == "__main__":
    main()


so100_config.json

{
  "type": "so100_follower",
  "id": "my_awesome_follower_arm",
  "port": "/dev/tty.usbmodem58760434471",
  "disable_torque_on_disconnect": true,
  "max_relative_target": 20.0,
  "use_degrees": false
}

pose.json

{
  "shoulder_pan": 0.0,
  "shoulder_lift": -10.0,
  "elbow_flex": 20.0,
  "wrist_flex": 0.0,
  "wrist_roll": 0.0,
  "gripper": 100.0
}

{
  "shoulder_pan.pos": 0.0,
  "shoulder_lift.pos": -10.0,
  "elbow_flex.pos": 20.0
}

python move_to_location.py --config so100_config.json --location pose.json